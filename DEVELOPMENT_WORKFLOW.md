# üöÄ Workflow —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±–µ–∑ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –≤ –ø—Ä–æ–¥–∞–∫—à–Ω

## üéØ **–ü—Ä–æ–±–ª–µ–º–∞**
–õ–æ–∫–∞–ª—å–Ω–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ Google OAuth –Ω–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç. –ù—É–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ —Å –ø—Ä–æ–¥–∞–∫—à–Ω-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π.

## üîß **–†–µ—à–µ–Ω–∏–µ: –ú–Ω–æ–≥–æ—Å—Ä–µ–¥–æ–≤–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞**

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ä–µ–¥:**
- **`development`** - –ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- **`staging`** - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥–∞–∫—à–Ω-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- **`production`** - —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –¥–µ–ø–ª–æ–π

## üìã **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç**

### 1. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Å—Ä–µ–¥–∞–º–∏**
```bash
# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ development (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
npm run switch-env dev

# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ staging (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥–∞–∫—à–Ω-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
npm run switch-env staging

# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ production (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
npm run switch-env prod
```

### 2. **–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞**
```bash
# Development —Ä–µ–∂–∏–º —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π
npm run dev

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥–∞–∫—à–Ω-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ª–æ–∫–∞–ª—å–Ω–æ
npm run test-prod

# Production —Ä–µ–∂–∏–º
npm start
```

### 3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
```bash
npm run check-env
```

## üîÑ **Workflow —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**

### **–≠—Ç–∞–ø 1: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞**
```bash
# 1. –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ development
npm run switch-env dev

# 2. –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
npm run dev

# 3. –†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
# 4. Google OAuth —Ä–∞–±–æ—Ç–∞–µ—Ç —Å localhost:3000
```

### **–≠—Ç–∞–ø 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥–∞–∫—à–Ω-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
```bash
# 1. –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ staging
npm run switch-env staging

# 2. –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å –ø—Ä–æ–¥–∞–∫—à–Ω-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
npm run test-prod

# 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º:
#    - Google OAuth callback URL
#    - CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
#    - Session –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
#    - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```

### **–≠—Ç–∞–ø 3: –î–µ–ø–ª–æ–π –≤ –ø—Ä–æ–¥–∞–∫—à–Ω**
```bash
# 1. –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ production
npm run switch-env prod

# 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
npm run check-env

# 3. –ö–æ–º–º–∏—Ç–∏–º –∏ –ø—É—à–∏–º
git add .
git commit -m "Fix OAuth configuration for production"
git push origin main

# 4. Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç
```

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ OAuth –ª–æ–∫–∞–ª—å–Ω–æ**

### **–ú–µ—Ç–æ–¥ 1: –¢–µ—Å—Ç-–ø—Ä–æ–¥–∞–∫—à–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**
```bash
npm run test-prod
```
–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- –°–æ–∑–¥–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π `.env.test-prod`
- –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä —Å `NODE_ENV=production`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–¥–∞–∫—à–Ω callback URL
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### **–ú–µ—Ç–æ–¥ 2: –†—É—á–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ**
```bash
# 1. –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ staging
npm run switch-env staging

# 2. –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
npm run dev

# 3. –¢–µ—Å—Ç–∏—Ä—É–µ–º OAuth
# 4. –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ development
npm run switch-env dev
```

## üîç **–û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º**

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
```bash
npm run check-env
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤**
–í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è:
```
üåç –ó–∞–≥—Ä—É–∂–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Å—Ä–µ–¥—ã: staging
‚úÖ Google OAuth –Ω–∞—Å—Ç—Ä–æ–µ–Ω
Google OAuth callback URL: https://kbju-tracker-staging.onrender.com/auth/google/callback
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**
```bash
# –í staging —Ä–µ–∂–∏–º–µ
echo $NODE_ENV          # –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "staging"
echo $GOOGLE_CALLBACK_URL  # –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å staging URL
```

## üìÅ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤**

```
backend/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ environments.js     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ä–µ–¥
‚îÇ   ‚îî‚îÄ‚îÄ index.js           # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ switch-env.js      # –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ä–µ–¥
‚îÇ   ‚îú‚îÄ‚îÄ test-prod-config.js # –¢–µ—Å—Ç –ø—Ä–æ–¥–∞–∫—à–Ω-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ check-env.js       # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ .env                   # –¢–µ–∫—É—â–∞—è —Å—Ä–µ–¥–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è)
```

## ‚ö†Ô∏è **–í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã**

### **1. Google Cloud Console**
–î–ª—è –∫–∞–∂–¥–æ–π —Å—Ä–µ–¥—ã –Ω—É–∂–µ–Ω —Å–≤–æ–π callback URL:
- **Development**: `http://localhost:3000/auth/google/callback`
- **Staging**: `https://kbju-tracker-staging.onrender.com/auth/google/callback`
- **Production**: `https://kbju-tracker.onrender.com/auth/google/callback`

### **2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
–ö–∞–∂–¥–∞—è —Å—Ä–µ–¥–∞ –∏–º–µ–µ—Ç —Å–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- CORS origins
- Session –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- Logging —É—Ä–æ–≤–µ–Ω—å

### **3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
- **Development**: —Ç–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- **Staging**: —Ç–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ–¥–∞–∫—à–Ω-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- **Production**: —Ç–æ–ª—å–∫–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –¥–µ–ø–ª–æ–π

## üöÄ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞**

1. **–ë—ã—Å—Ç—Ä–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –Ω–µ –Ω—É–∂–Ω–æ –¥–µ–ø–ª–æ–∏—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–Ω
2. **–ò–∑–æ–ª—è—Ü–∏—è —Å—Ä–µ–¥** - –∫–∞–∂–¥–∞—è —Å—Ä–µ–¥–∞ –∏–º–µ–µ—Ç —Å–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
3. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - —Ç–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ–¥–∞–∫—à–Ω-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ª–æ–∫–∞–ª—å–Ω–æ
5. **–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏** - –±—ã—Å—Ç—Ä—ã–π —Ü–∏–∫–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## üîß **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫**

### **–ü—Ä–æ–±–ª–µ–º–∞: OAuth –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ staging**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
npm run check-env

# 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º Google Cloud Console
# 3. –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ callback URL –¥–æ–±–∞–≤–ª–µ–Ω

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
npm run test-prod
```

### **–ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â—É—é —Å—Ä–µ–¥—É
npm run switch-env staging

# 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º .env —Ñ–∞–π–ª
cat .env

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
npm run dev
```

–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–µ –¥–µ–ø–ª–æ—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω! üéâ
